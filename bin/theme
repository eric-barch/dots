#!/bin/zsh

if [ -z "$1" ]; then
  echo "Usage: $0 <theme-name>"
  exit 1
fi

THEME_NAME=$1

THEME_CONFIG_PATH="$XDG_CONFIG_HOME/theme"

SCHEME_PATH="$THEME_CONFIG_PATH/schemes/base16/${THEME_NAME}.yaml"
BUILDER_PATH="$THEME_CONFIG_PATH/builder.lua"
TEMPLATE_PATH="$THEME_CONFIG_PATH/templates/shell.mustache"
OUTPUT_PATH="$ZDOTDIR/theme.zsh"

ZSHRC_PATH="$ZDOTDIR/.zshrc"

if [ ! -f "$SCHEME_PATH" ]; then
  echo "Error: Theme file '$SCHEME_PATH' not found."
  exit 1
fi

cat "$SCHEME_PATH" | lua "$BUILDER_PATH" -t "$TEMPLATE_PATH" > "$OUTPUT_PATH"

if [ $? -eq 0 ]; then
  source "$ZSHRC_PATH"
else
  echo "Error generating theme."
  exit 1
fi
